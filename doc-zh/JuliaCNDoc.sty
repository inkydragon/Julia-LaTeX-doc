\usepackage[% 上下、左右对称
  hmargin = 3.0cm, % left and right margin
  vmargin = 2.5cm, % top and bottom margin
]{geometry}
\usepackage{polyglossia}

%% font settings
\usepackage{fontspec}
\setsansfont{DejaVu Sans}[Scale=MatchLowercase, Ligatures=TeX]
\setmonofont{DejaVu Sans Mono}[Scale=MatchLowercase]
\renewcommand{\familydefault}{\sfdefault}

%%
% DejaVu Sans Mono does not have the xor symbol. So we hack around that by replacing all
% instances of it with calls to \unicodeveebar, which prints this single character as with
% DejaVu Sans instead.
\usepackage{newunicodechar}
\newfontfamily\unicodeveebarfont{DejaVu Sans}[Scale=MatchLowercase]
\newcommand\unicodeveebar{{\unicodeveebarfont ⊻}}

% colours
\usepackage{xcolor}

\definecolor{light-blue}{HTML}{6b85dd}
\definecolor{dark-blue}{HTML}{4266d5}
\definecolor{light-red}{HTML}{d66661}
\definecolor{dark-red}{HTML}{c93d39}
\definecolor{light-green}{HTML}{6bab5b}
\definecolor{dark-green}{HTML}{3b972e}
\definecolor{light-purple}{HTML}{aa7dc0}
\definecolor{dark-purple}{HTML}{945bb0}
%

% maths
\usepackage{amsmath, amssymb}
%

% listings
\usepackage{listings, minted}
%% 保存中文缩进长度
\newlength{\zhParIndent}
\setlength{\zhParIndent}{\parindent + 2pt} % 保持视觉上的对齐
\lstset{
    basicstyle = \small\ttfamily,
    breaklines = true,
    columns = fullflexible,
    frame = leftline,
    keepspaces = true,
    showstringspaces = false,
    % 对齐段首缩进；listings 宏包的所及计算比较复杂
    xleftmargin=\dimexpr\zhParIndent+\lst@frametextsep+\lst@framerulewidth\relax,
}

\setminted{
    breaklines = true,
    fontsize = \small,
    frame = leftline,
    xleftmargin = \zhParIndent, % 对齐段首缩进
}
%

%% itemize / 无序列表
\usepackage{enumitem}
\setitemize{
    % 对齐段首缩进
    leftmargin=\dimexpr \parindent + 0.5\labelwidth + \labelsep - \itemindent \relax,
    % 消除各 item 之间的间距
    itemsep=0pt,
    partopsep=0pt,
    parsep=\parskip,
    topsep=5pt
}
%

% tables
\usepackage{tabulary}
\usepackage{longtable, booktabs}
\usepackage{lscape}
%

% hyperref
\usepackage{hyperref}
\hypersetup{
    pdfpagelabels,
    bookmarks,
    hyperindex,
    unicode = true,
    linkcolor = dark-blue,
    urlcolor = dark-purple,
    colorlinks = true,
}
%

% table of contents
\maxtocdepth{subsection}
%

%% TODO: 确认段落和边距设置可用
% paragraphs
\setlength{\parindent}{0pt}
\nonzeroparskip
%

% adjust margins
\setulmarginsandblock{1.5in}{1in}{*}
\setlrmarginsandblock{1.5in}{1in}{*}
\setheaderspaces{1in}{*}{*}
\checkandfixthelayout
%

% images etc.
\usepackage{graphicx}
\usepackage[export]{adjustbox}
%

% for {adjustwidth} env
\usepackage{changepage}
